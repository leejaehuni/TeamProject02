<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kfarmstar.admin.mapper.MemberMapper">
	<resultMap type="AfterPayment" id="afterPaymentMap">
		<result column="payment_complete_code" 		property="paymentCompleteCode"/>
		<result column="purchaser_payment_code" 	property="purchaserPaymentCode"/>
		<result column="goods_refurb_code" 			property="goodsRefurbCode"/>
		<result column="member_id" 					property="memberId"/>
		<result column="before_goods_count" 		property="beforeGoodsCount"/>
		<result column="mid_sum_price" 				property="midSumPrice"/>
		<result column="payment_option" 			property="paymentOption"/>
		<result column="last_payment_price" 		property="lastPaymentPrice"/>
		<result column="delivery_post_num" 			property="deliveryPostNum"/>
		<result column="delivery_addr" 				property="deliveryAddr"/>
		<result column="delivery_detail_addr" 		property="deliveryDetailAddr"/>
		<result column="payment_date" 				property="paymentDate"/>
		<association property="member" javaType="Member">
			<result column="member_id" 				property="memberId"/>
			<result column="member_name" 			property="memberName"/>
			<result column="member_level" 			property="memberLevel"/>
			<result column="member_pw" 				property="memberPw"/>
			<result column="member_nickname" 		property="memberNickname"/>
			<result column="member_phone" 			property="memberPhone"/>
			<result column="member_post_num" 		property="memberPostNum"/>
			<result column="member_addr" 			property="memberAddr"/>
			<result column="member_detail_addr" 	property="memberDetailAddr"/>
			<result column="member_birth" 			property="memberBirth"/>
			<result column="member_email" 			property="memberEmail"/>
			<result column="member_point" 			property="memberPoint"/>
			<result column="member_date" 			property="memberDate"/>
		</association>
		<association property="goods" javaType="Goods">
			<result column="goods_refurb_code" 			property="goodsRefurbCode"/>
			<result column="seller_store_num" 			property="sellerStoreNum"/>
			<result column="goods_large_code" 			property="goodsLargeCode"/>
			<result column="goods_small_code" 			property="goodsSmallCode"/>
			<result column="member_id" 					property="memberId"/>
			<result column="goods_large_cate" 			property="goodsLargeCate"/>
			<result column="goods_small_cate" 			property="goodsSmallCate"/>
			<result column="goods_refurb_name" 			property="goodsRefurbName"/>
			<result column="goods_normal_price" 		property="goodsNormalPrice"/>
			<result column="goods_refurb_price" 		property="goodsRefurbPrice"/>
			<result column="goods_refurb_count" 		property="goodsRefurbCount"/>
			<result column="goods_refurb_harvest_date" 	property="goodsRefurbHarvestDate"/>
			<result column="goods_refurb_organic" 		property="goodsRefurbOrganic"/>
			<result column="goods_post_explain" 		property="goodsPostExplain"/>
			<result column="goods_refurb_sell_state" 	property="goodsRefurbSellState"/>
			<result column="entry_time" 				property="entryTime"/>
		</association>
		<association property="puchaserPayment" javaType="PuchaserPayment">
			<result column="purchaser_payment_code" 	property="purchaserPaymentCode"/>
			<result column="goods_refurb_code" 			property="goodsRefurbCode"/>
			<result column="member_id" 					property="memberId"/>
			<result column="before_mid_sum_code" 		property="beforeMidSumCode"/>
			<result column="before_goods_count" 		property="beforeGoodsCount"/>
			<result column="mid_sum_price" 				property="midSumPrice"/>
			<result column="payment_option" 			property="paymentOption"/>
			<result column="delivery_postnum_addr" 		property="deliveryPostnumAddr"/>
			<result column="delivery_addr" 				property="deliveryAddr"/>
			<result column="delivery_detail_aadr" 		property="deliveryDetailAddr"/>
			<result column="recipient_name" 			property="recipientName"/>
			<result column="recipient_phone" 			property="recipientPhone"/>
		</association>
	</resultMap>
	
	<select id="afterPaymentInfo" resultMap="afterPaymentMap">
		/* 구매자 상품 구매 내역 조회 */
		SELECT
			 p.payment_complete_code
			,p.purchaser_payment_code
			,p.goods_refurb_code
			,p.member_id
			,p.before_goods_count
			,p.mid_sum_price
			,p.payment_option
			,p.last_payment_price
			,p.delivery_post_num
			,p.delivery_addr
			,p.delivery_detail_addr
			,p.payment_date
		FROM
			after_payment_info AS p
			INNER JOIN
				member AS m
			ON
			p.member_id = m.member_id
			INNER JOIN
				goods_management AS g
			ON
			p.goods_refurb_code = g.goods_refurb_code
			INNER JOIN
				before_purchaser_info AS b
			ON
			p.purchaser_payment_code = b.purchaser_payment_code
		WHERE
			m.member_level = '구매자';
	
	
	</select>
	
</mapper>